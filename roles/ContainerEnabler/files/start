#!/bin/bash

VARNISH_OPTIONS="-f ${VARNISH_VCL_CONF}"

[[ -z "${VARNISH_LISTEN_PORT}" ]] || VARNISH_OPTIONS+=" -a ${VARNISH_LISTEN_ADDRESS}:${VARNISH_LISTEN_PORT}"
[[ -z "${VARNISH_ADMIN_LISTEN_PORT}" ]] || VARNISH_OPTIONS+=" -T ${VARNISH_ADMIN_LISTEN_ADDRESS}:${VARNISH_ADMIN_LISTEN_PORT}"
[[ -z "${VARNISH_TTL}" ]] || VARNISH_OPTIONS+=" -t ${VARNISH_TTL}"
[[ -z "${VARNISH_SECRET_FILE}" ]] || VARNISH_OPTIONS+=" -S ${VARNISH_SECRET_FILE}"
[[ -z "${VARNISH_STORAGE}" ]] || VARNISH_OPTIONS+=" -s ${VARNISH_STORAGE}"
[[ -z "${VARNISH_THREADS}" ]] || VARNISH_OPTIONS+="-w ${VARNISH_THREADS}"
[[ -z "${VARNISH_PARAMETERS}" ]] || VARNISH_OPTIONS+=" ${VARNISH_PARAMETERS}"

varnishd ${VARNISH_OPTIONS}

varnishlog
